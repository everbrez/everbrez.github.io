---
layout: post
title:  cache
date:   2019-02-17
categories: javascript
---

## Service Worker
`navigation.serviceWorker`
Service Worker 是运行在浏览器的另一个独立线程
- 传输协议必须是HTTPS（Service Worker 中涉及到请求拦截，所以必须使用 HTTPS 协议来保障安全。）

步骤：
1. 注册Server Worker
```js
navigator.serviceWorker.register('worker.js').then(e => console.log('success')).catch(e => console.log('error'))
```
2. 监听`install`事件，缓存需要的文件
```js
// worker.js
self.addEventListener('install', (e) => {
  e.waitUntil(
    caches.open('my-cache').then(cache => {
      return cache.addAll(['./index.html', './index.js'])
    })
  )
})

// 拦截请求
self.addEventListener('fetch', (e) => {
  e.respondWith(
    cache.match(e.request).then(response => {
      if (responese) {
        return responese
      }
    })
  )
})
```
3. 在下次用户访问的时候就可以通过拦截请求的方式查询是否有缓存，如果存在缓存就使用缓存，如果没有就去请求数据